{% extends 'base.html' %}
{% block title %}学習記録一覧{% endblock %}
{% block content %}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-person-circle me-2"></i>学習記録一覧</h2>
        <a href="/dashboard" class="btn btn-secondary">戻る</a>
    </div>

    {% for post in posts %}
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between">
            <h5 class="mb-0">
                <a href="/{{ post.id }}/readmore">
                    {{ post.title }}
                </a>
            </h5>
            <span class="text-muted">{{ post.created_at.strftime('%Y/%m/%d %H:%M') }}</span>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- 学習内容 -->
                <div class="col-md-7">
                    <h6><i class="bi bi-card-text me-2"></i>内容</h6>
                    <p class="card-text">{{ post.content | replace('\n', '<br>') | safe }}</p>
                </div>
                
                <!-- 学習時間・カテゴリ -->
                <div class="col-md-5 border-start">
                    <h6><i class="bi bi-clock me-2"></i>学習時間</h6>
                    <ul class="list-unstyled">
                        {% for detail in post.details %}
                        <li>
                            <span class="badge bg-primary">{{ detail.category.name }}</span>
                            <strong>{{ detail.duration_minutes }}</strong> 分
                        </li>
                        {% endfor %}
                    </ul>
                    <!-- 参照資料 -->
                    <h6 class="mt-3"><i class="bi bi-link-45deg me-2"></i>参照資料</h6>
                    {% for ref in post.references %}
                    <div class="small mb-2 p-2 border rounded bg-light">
                        <div><strong>{{ ref.title }}</strong></div>
                        {% if ref.url %}<a href="{{ ref.url }}" target="_blank" class="text-truncate d-block">URLを開く</a>{% endif %}
                        <div class="text-warning">
                            {% if ref.rating %}{% for i in range(ref.rating) %}★{% endfor %}{% endif %}
                        </div>
                        {% for cat in ref.categories %}
                        <span class="badge bg-info text-dark" style="font-size: 0.7rem;">{{ cat.name }}</span>
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">投稿データが見つかりませんでした。</div>
    {% endfor %}
</div>


{% endblock %}
